@model Models.Goods
@{
//Layout = "~/Views/Shared/Layoutmall.cshtml";

}
<style>
    * {
        margin: 0;
        padding: 0;
    }

    ul {
        list-style: none;
    }

    .center {
        width: 1005px;
        height: 600px;
        margin-left: 360px;
        margin-top: 20px;
    }

    .pic img {
        width: 300px;
        height: 300px;
    }

    .details {
        width: 300px;
        height: 300px;
        margin-left: 330px;
        margin-top: -300px;
    }

    .comment {
        width: 700px;
        height: 60px;
    }

    .CommentReply {
        width: 900px;
        margin: 0 auto;
    }

        .CommentReply li {
            margin-bottom: 30px;
        }

    .pinglun {
        margin-left: 434px;
        margin-bottom: 40px;
    }

    .textA {
        resize: none;
        border-radius: 4px;
        -webkit-border-radius: 4px;
        -moz-border-radius: 4px;
        height: 68px;
        width: 798px;
        display: block;
        border: 1px solid #c03f3c;
    }
    #price{
        font-size:24px;
         color:red;
    }
    #goodsid{
        visibility:hidden;
    }
    #s{

    }
    #tt{
        height:200px;
        height:200px;
        border-radius:3px;
    }
    #pl{
        background-color:red;
    }
    #p2{

    }
</style>


<div class="center" id="center">
    <div class="pic">
        <img src="~/Images/GoodsImages/@Model.GoodsImage" />
        <div class="mask"></div>
    </div>
   

    <div class="details">
        @using (Html.BeginForm("Cart", "Mall", FormMethod.Post))
        {
            <h3>@Model.Name</h3>
            <div style="width:100%;height:40px;background-color:lavenderblush;">
                <span style="color:darkgoldenrod;font-size:18px;height:40px;line-height:40px;display:inline-block;">价格：</span>
                <span>￥@Model.Unitprice</span>
                @*<p>@Model.GoodsID</p>*@
                <input type="hidden" name="price" value="@Model.Unitprice" />
                <input type="hidden" name="goods" value="@Model.GoodsID" />
                @Html.Hidden("Price", Model.Unitprice);
                <input type="hidden" value="@Model.Unitprice" name="unitprice" />
                @*<input type="text" name="zongjia" value="@Model.Unitprice * @total" readonly="readonly" />*@
            </div>
            <h4 style="color:dimgray">江浙沪顺丰包邮</h4>
            <div style="height:40px;width:100%;margin-top:20px;">
                <span>数量：</span>
                @Html.Hidden("GoodsID", Model.GoodsID);
                <input type="number" min="1" max="@Model.Amount" value="1" style="width:80px;" name="number" id="s" />

                <div style="margin-top:10px;">
                    <span>库存：</span>
                    <span id="kucun">@Model.Amount</span>
                    <div style="margin-top:10px;">
                        <a href="@Url.Action("Cart","Mall",new {GoodsID=Model.GoodsID }) "><button style="background-color:red; color:white;" class="btn btn-default" id="jrgwc" type="submit">加购物车</button></a>
                        @*<button type="button" style="background-color:red"; color:white;id="Sub" >直接购买</button>*@

                        @*<button style="background-color:red; color:white;" class="btn btn-default" id="buy">直接购买</button>*@
                        <button type="button" style="background-color:red; color:white;" class="btn btn-default" data-toggle="modal" data-target="#myModal1">直接购买</button>
                            <div class="modal fade" id="myModal1" tabindex="-1" role="dialog" aria-labelledby="myModalLabel1" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                                                &times;
                                            </button>
                                            <h4 class="modal-title" id="myModalLabel1">
                                                请填写信息：
                                            </h4>
                                        </div>
                                        <div class="modal-body">
                        <label for="Ord_Name">收件人：</label>
                        <input id="Name" name="Name" type="text" />
                        <br />
                        <label for="Ord_Add">地&nbsp;&nbsp;&nbsp;址：</label>
                        <input id="Address" name="Address" type="text" />
                        <br />
                        <label for="Ord_Tel">电&nbsp;&nbsp;&nbsp;话：</label>
                        <input id="Tel" name="Tel" type="text" />
                        
                        </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">
                                    关闭
                                </button>
                                <button type="button" id="Sub" class="btn btn-primary">
                                    提交
                                </button>
                            </div>
                        </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

            
       }           
     </div>
</div>
<hr />
@using (Html.BeginForm("Comment", "Mall", FormMethod.Post,new {goodsid=Model.GoodsID }))
{
    <div>
        <textarea name="pinglun" style="border-radius:4px;height:68px;width:798px;display:block;border:1px solid #c03f3c" id="tt"></textarea>
        <button id="pl">发表评论</button>
    </div>
   
}
<div id="p2">
    @{Html.RenderAction("Comment", "Mall",new { goodsid=Model.GoodsID});}
</div>


<script src="~/Scripts/jquery-1.10.2.min.js"></script>
@*<script src="~/Scripts/jquery-3.3.1.min.js"></script>*@
<script>
    $(function (){
        var uname = $("#Name");
        
        var add = $("#Address");
        var tel = $("#Tel")
       
       var price = $("input[name='unitprice']");
       var num = $("input[name='number']");
       var total =parseInt(price.val()) * parseInt(num.val());
       
       var GoodsID = $("input[name='goods']");
        
        $("#Sub").on("click", function () {
            
            $.ajax({
                type: 'post',
                //dataType: 'json',
                url: "/Mall/DirectBuy",
                data: {
                    "total": total,
                    "uname": uname.val(),
                    "tel": tel.val(),
                    "address":add.val(),
                    "goodsid": GoodsID.val(),
                    "num":num.val()
                    
                },
                //traditional: true,
                success: function (data) {
                    
                    alert(data.message);
                    location.href = "/Mall/Order";
                   
                },
                error: function () {
                    alert("购物失败");
                }
            });
        });


        var pinglun = $("#tt");
        $("pl").on("click", function () {
            $.ajax({
                type: 'post',
                url: "/Mall/Comment",
                data: {
                    "goodsid":GoodsID.val(),
                    "text":pinglun.val()
                },
                success:function(data){
                    $("#p2").html(data);
                }
            })
        }

    )}

    //})

)
</script>